# Proyecto - Configuración de Claude Code

## Proyecto: Oracle to PostgreSQL Migration Tool

### Estrategia de Implementación

**Herramienta:** Claude Code CLI/Web (suscripción Pro $20/mes)
**Modelo:** Claude Sonnet 4.5
**Enfoque:** Sub-agentes nativos de Claude Code

**Documento maestro de estrategia:**
- `.claude/ESTRATEGIA_MIGRACION.md` - **LEER PRIMERO**

### Documentación del Proyecto

**Discovery y Decisiones:**
- `.claude/sessions/oracle-postgres-migration/` - Conocimiento del proyecto
  - `00_index.md` - Resumen ejecutivo y números clave
  - `01_problem_statement.md` - Problema, objetivos, scope
  - `02_user_stories.md` - Épicas y criterios de aceptación
  - `04_decisions.md` - Decisiones técnicas críticas
  - `README.md` - Guía de navegación

**Estado Actual:**
- 8,122 objetos PL/SQL a migrar
- DDL ya convertido y ejecutado en PostgreSQL
- Pendiente: código PL/SQL → PL/pgSQL

### Flujo de Trabajo (4 Fases)

**FASE 1: ANÁLISIS Y CLASIFICACIÓN** (5 horas - 1 sesión)
- 20 sub-agentes "plsql-analyzer" en paralelo
- 10 objetos por sub-agente = 200 objetos por mensaje
- Output: knowledge/{json,markdown}/, classification/

**FASE 2A: CONVERSIÓN SIMPLE** (30 minutos - local)
- ~5,000 objetos SIMPLE con ora2pg
- Ejecutar script bash local: `scripts/convert_simple_objects.sh`
- Costo tokens Claude: 0 ✅

**FASE 2B: CONVERSIÓN COMPLEJA** (5 horas - 1 sesión)
- ~3,122 objetos COMPLEX con sub-agentes
- 20 sub-agentes "plsql-converter" en paralelo
- Estrategias para AUTONOMOUS_TRANSACTION, UTL_HTTP, DBMS_SQL, etc.

**FASE 3: VALIDACIÓN DE COMPILACIÓN** (5 horas - 1 sesión)
- 20 sub-agentes "compilation-validator" en paralelo
- Conectan a PostgreSQL y ejecutan scripts
- Capturan errores y sugieren fixes

**FASE 4: SHADOW TESTING** (10 horas - 2 sesiones)
- 10 sub-agentes "shadow-tester" en paralelo
- Ejecutan mismo código en Oracle y PostgreSQL
- Comparan resultados (objetivo: >95% idénticos)

**Timeline Total:**
- 25.5 horas efectivas
- 5-6 sesiones de 5 horas
- 2-3 días calendario
- 184 mensajes de ~250 disponibles (margen: 66 mensajes)

Ver detalles completos en `ESTRATEGIA_MIGRACION.md`

### Capacidades Confirmadas

**Experimentación 2025-01-05:**
- ✅ 3 sub-agentes en paralelo - EXITOSO
- ✅ 10 sub-agentes en paralelo - EXITOSO (172,383 líneas procesadas)
- ✅ 20 sub-agentes en paralelo - EXITOSO

**Límites Claude Code Pro:**
- ~45-60 mensajes cada 5 horas
- Contexto: 200K tokens por mensaje
- Contexto por sub-agente: 200K tokens (independiente)
- Sub-agentes en paralelo: 20+ confirmado

**IMPORTANTE:**
- Claude Code CLI y Web comparten los MISMOS límites
- El modelo a usar es Claude Sonnet 4.5 (suficiente para análisis de código)

### Herramientas y Tecnologías

**Claude Code:**
- Sub-agentes nativos (sin costo adicional)
- Incluido en suscripción Pro

**Herramientas Locales (GRATIS):**
- **ora2pg:** Conversión automática de objetos SIMPLES
- **sentence-transformers:** Generación de embeddings locales
- **PostgreSQL 17.4 + pgvector:** Base de datos vectorial

**AWS (Ya configurado):**
- **Aurora PostgreSQL 17.4:** Base de datos destino
- **S3:** Almacenamiento de archivos (DIRECTORY objects)
- **Lambda:** HTTP client para UTL_HTTP (pendiente crear)

### Plugin de Sub-agentes

**Plugin creado:** `.claude/plugins/oracle-postgres-migration/`

**4 Agentes especializados:**
1. **plsql-analyzer** - Análisis y clasificación (FASE 1)
2. **plsql-converter** - Conversión compleja (FASE 2B)
3. **compilation-validator** - Validación de compilación (FASE 3)
4. **shadow-tester** - Testing comparativo (FASE 4)

**Documentación del plugin:**
- `QUICKSTART.md` - Inicio rápido (5 minutos)
- `README.md` - Guía completa del plugin
- `agents/*.md` - System prompts de cada agente

**Ejemplos de uso:**
- `examples/phase1_launch_example.md` - Cómo lanzar FASE 1
- `scripts/convert_simple_objects.sh` - Script FASE 2A (ora2pg)

**Inicio rápido:**
```bash
# Ver guía de inicio rápido
cat .claude/plugins/oracle-postgres-migration/QUICKSTART.md

# Ejemplo completo FASE 1
cat examples/phase1_launch_example.md
```

### Convenciones

- **Documentación:** Español
- **Código:** Inglés (nombres de variables, funciones, clases)
- **Términos técnicos:** Sin traducir (endpoint, hook, middleware, etc.)

### Archivos Archivados

**`.claude/archived/pydantic-ai-plans/`**
- Planes obsoletos de Pydantic AI (2024-12-30 a 2025-01-03)
- Archivados porque requerían API de Anthropic (no disponible)
- Ver `README.md` en ese directorio para detalles

**`.claude/archived/CLAUDE.md.backup`**
- Backup del framework Context Flow Optimization original
- Framework diseñado para Pydantic AI, no aplicable a Claude Code CLI/Web

---

**Configuración actualizada:** 2025-01-05
**Estrategia:** Claude Code CLI/Web con sub-agentes nativos
**Próximo paso:** Ver `.claude/ESTRATEGIA_MIGRACION.md` para iniciar FASE 1
